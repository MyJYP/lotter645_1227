# 🔒 고정 모드(Fixed Mode) 고도화 플랜

## 1. 개요

현재 '고정 모드'는 다음 회차 번호를 시드(Seed)로 사용하여 매번 동일한 결과를 보여주는 '재현성'에 초점을 맞추고 있습니다. 이를 넘어, **"이번 주 단 한 게임만 산다면 무엇을 사야 하는가?"**에 대한 수학적이고 통계적인 최적해를 제공하는 방향으로 고도화합니다.

## 2. 현황 및 문제점

- **현황**: `random.seed(next_round)`를 사용하여 난수 발생을 고정함.
- **문제점**:
  - 시드에 의한 고정일 뿐, 해당 조합이 알고리즘상 '최고 점수'를 보장하지 않음 (랜덤 샘플링의 한계).
  - `best_only` 옵션이 있지만 일부 전략에만 제한적으로 적용됨.
  - 사용자가 "왜 이 번호인가?"에 대한 근거를 직관적으로 알기 어려움.

## 3. 개선 목표

1.  **결정론적(Deterministic) 추천**: 랜덤 요소를 배제하고 데이터 기반 최적 조합 산출.
2.  **설명 가능한 추천(XAI)**: 추천된 고정 조합의 선정 근거(점수, 패턴 적합도 등) 제시.
3.  **수익률 방어**: 최소 5등(3개 일치) 당첨 확률 극대화.

## 4. 세부 실행 계획 (Roadmap)

### Phase 1: 결정론적 추천 엔진 (Deterministic Engine) 도입

- **내용**: 모든 추천 전략에 `best_only` 모드(완전 탐색) 구현.
- **구현 방안**:
  - 기존: 상위 N개 후보군에서 랜덤 샘플링.
  - 변경: 상위 20~25개 후보군으로 만들 수 있는 모든 조합(Combinations)을 생성하고, 스코어링 함수로 전수 평가하여 1등 조합 추출.
    - _참고: 20C6 = 38,760개 (연산 가능 범위)_
  - 대상 전략: 하이브리드, 패턴, 그리드, 이미지 등 모든 전략.

### Phase 2: 앙상블 보팅 시스템 (Ensemble Voting System)

- **내용**: 여러 전략의 의견을 종합하여 하나의 '마스터 조합' 생성.
- **로직**:
  1. 5개 전략(가중치, 패턴, 그리드, 이미지, 연속)이 각각 Top 10 조합 생성.
  2. 생성된 50개 조합에 포함된 개별 번호의 빈도 분석.
  3. 가장 많이 중복 추천된 번호 6개를 선정하여 '앙상블 고정 조합' 생성.
  4. 전략 간 합의(Consensus)가 이루어진 번호를 우선시함.

### Phase 3: 강력한 제외수(Kill Number) 필터링

- **내용**: 고정 모드에서는 확률이 극히 낮은 번호를 과감하게 배제하여 적중률 향상.
- **필터링 기준**:
  - **제외수**: 최근 10주간 4회 이상 출현한 과열 번호 (일부 전략 제외).
  - **동반 제외**: 역사적으로 동반 출현 0회인 '상극수' 조합 배제.
  - **패턴 제외**: 4연속 번호, 전멸 구간 3개 이상 등 희박한 패턴 배제.

### Phase 4: 사용자 인터랙티브 튜닝 (Semi-Auto)

- **내용**: 알고리즘이 추천한 6개 중 사용자가 마음에 들지 않는 번호를 클릭하여 교체.
- **UI/UX**:
  - 추천된 번호 클릭 시 -> "이 번호 대신 넣을만한 차순위 추천 번호: N번 (점수 차이 -0.1)" 제안.
  - 사용자의 직관과 알고리즘의 분석을 결합.

## 5. 기대 효과

- **신뢰도 상승**: "운"이 아닌 "철저한 분석" 결과라는 인식 강화.
- **비용 효율성**: 1게임(1,000원)으로 최대 효율 추구.
- **사용자 경험**: 분석 근거 확인 및 능동적 개입 가능.

## 6. 작업 진행 상황

- [x] **Phase 1**: `src/recommendation_system.py`에 `best_only` (결정론적 추천) 로직 구현 완료.
- [x] **Phase 2**: `src/recommendation_system.py` 및 웹 앱에 '앙상블 보팅' 전략 추가 완료.
- [x] **Phase 3**: 과열 번호, 상극수, 희박 패턴 필터링 로직 구현 및 테스트 완료 (`docs/TEST_REPORT_PHASE3.md`).
- [x] **Phase 4**: `src/web_app.py`에 사용자 인터랙티브 튜닝(번호 교체) 기능 구현 완료.
- [x] **Phase 4**: `src/web_app.py`에 사용자 인터랙티브 튜닝(번호 교체) 기능 구현 및 테스트 완료.

## 7. 최종 완료

모든 단계(Phase 1~4)의 구현 및 테스트가 성공적으로 완료되었습니다. (2026-02-07)
