# 🎲 로또 6/45 알고리즘 개선 계획서

> "수익률이 마이너스인데 원금을 보장해줘야 하지 않겠어"

위 피드백을 바탕으로, 현재 백테스팅 시스템의 수익성을 개선하고 알고리즘의 신뢰도를 높이기 위한 구체적인 실행 계획을 수립합니다.

## 1. 핵심 목표

**"대박"이 아닌 "손실 최소화" 및 "수익 안정성" 확보**

- **단기 목표**: 고정 모드(1게임) 백테스팅 시, 5등 당첨 빈도를 높여 ROI(수익률)를 **-50% 이상**으로 방어하는 것을 목표로 합니다.
- **장기 목표**: 다양한 전략 조합을 통해, 1년 단위 백테스팅에서 **ROI 0% (원금 보존)**에 근접하는 최적의 추천 모델을 개발합니다.

---

## 2. 주요 개선 전략 (Action Plan)

### 전략 1: "원금 보존" 추구형 신규 추천 전략 개발

- **현황**: 현재 전략(하이브리드, 스코어 등)은 모든 번호에 동일한 가치를 부여하여 고득점 조합을 찾지만, 5등 당첨에 필수적인 '핵심 번호'를 놓칠 수 있습니다.
- **개선 방안**: **'안정형(Safe)' 전략**을 새로 개발합니다.
    1.  **'필수 포함 그룹' 선정**: 최근 5주간 가장 많이 나온 번호, 통계적으로 출현 주기가 임박한 번호 등을 10~15개 선정합니다.
    2.  **조합 생성 규칙 변경**: `n`개의 조합을 생성할 때, '필수 포함 그룹'의 번호를 **최소 2개 이상 반드시 포함**하도록 규칙을 강제합니다.
    3.  **기대 효과**: 꽝(0~2개 일치)의 비율을 줄이고, 5등(3개 일치) 당첨 확률을 극대화하여 투자금을 꾸준히 회수하는 효과를 기대할 수 있습니다.

### 전략 2: 고정 모드(1게임) 추천 로직 강화

- **현황**: `n_combinations=1`로 추천 시, 랜덤 요소가 개입하여 매번 다른 최적 조합이 나올 수 있어 일관성이 부족합니다.
- **개선 방안**: `generate_hybrid` 또는 `generate_by_score` 메서드에 **`best_only=True`** 파라미터를 추가합니다.
    1.  **로직**: 이 옵션이 활성화되면, 모든 랜덤 요소를 비활성화하고 스코어링 시스템상 **점수가 가장 높은 단 1개의 조합**만을 확정적으로 반환합니다.
    2.  **적용**: 고정 모드 백테스팅 UI에서 이 옵션을 선택할 수 있는 체크박스를 제공합니다.
    3.  **기대 효과**: "알고리즘이 생각하는 현시점 최고의 조합은 무엇인가?"에 대한 명확한 답을 제공하여, 백테스팅의 신뢰도를 높입니다.

### 전략 3: 신규 피처(Feature) 추가를 통한 예측 모델 고도화

- **현황**: 현재는 번호 자체의 빈도, 추세, 미출현 기간 등에 집중하고 있습니다.
- **개선 방안**: 번호 **'간의 관계'**를 분석하는 피처를 추가하여 모델을 고도화합니다.
    1.  **연속 번호 패턴**: `(1, 2)`, `(20, 21, 22)` 등 연속된 번호가 함께 출현하는 패턴을 분석하여 가중치를 부여합니다.
    2.  **궁합수/상극수 분석**: 특정 번호가 나왔을 때 자주 함께 등장하는 번호(궁합수)와 절대 같이 나오지 않는 번호(상극수) 통계를 반영합니다.
    3.  **소수/합성수 비율**: 역대 당첨 번호의 소수/합성수 조합 비율을 분석하여, 생성되는 조합의 비율을 통계적으로 유사하게 조정합니다.
    4.  **기대 효과**: 단순한 점수 계산을 넘어, 실제 당첨 조합과 유사한 '구조적 특징'을 가진 번호 조합을 생성할 수 있습니다.

---

## 3. 구현 로드맵

| 단계 | 파일명 | 주요 작업 내용 | 예상 소요 시간 |
| :--- | :--- | :--- | :--- |
| **1단계 (긴급)** | `src/backtesting_system.py` | **'보너스번호' Key-Error 버그 수정** | 즉시 |
| **2단계** | `src/recommendation_system.py` | `best_only=True` 파라미터 및 로직 추가 | 2시간 |
| **3단계** | `src/web_app.py` | 고정 모드 UI에 '최적 조합만' 옵션 추가 | 1시간 |
| **4단계** | `src/pattern_analysis.py` | 연속 번호, 궁합수 등 신규 피처 분석 로직 추가 | 4시간 |
| **5단계** | `src/recommendation_system.py` | 신규 피처를 스코어링 시스템에 통합 | 2시간 |
| **6단계** | `src/web_app.py` | '안정형(Safe)' 전략 옵션 UI 추가 및 백테스팅 연동 | 2시간 |

이 계획을 바탕으로 즉시 1단계 버그 수정부터 진행하겠습니다.