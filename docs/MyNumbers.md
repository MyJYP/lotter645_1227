# 🎲 '나의 번호' (My Numbers) 기능 추가 계획서

## 1. 개요

기존의 분석 및 추천 기능에 더해, 사용자가 직접 선택한 번호("나의 번호")에 대한 심층적인 역사적 분석과 알고리즘 기반의 개선 제안을 제공하는 신규 섹션입니다. 재미 요소와 실용성을 결합하여 사용자 참여를 유도합니다.

## 2. 상세 기능 명세

### 2.1. 📜 나의 번호 당첨 연대기 (History)

**"내 번호가 과거에 1등에 당첨된 적이 있을까?"**

- **기능 정의**: 사용자가 입력한 6개 번호를 과거 전체 회차(601회~현재) 데이터와 대조하여 당첨 이력을 조회합니다.
- **입력 방식**: **실제 복권 용지처럼 생긴 7x7 그리드에서 번호를 클릭하여 마킹(선택/해제)합니다.**
- **분석 로직**:
  1. 전체 회차 당첨번호 로드.
  2. 각 회차별로 사용자 번호와 매칭되는 개수 확인.
  3. 등수 판별 (1등~5등, 꽝).
  4. 가상 수익률 계산 (매주 해당 번호를 샀다고 가정했을 때).
- **출력 UI**:
  - **요약 카드**: 총 당첨 횟수, 최고 등수, 총 당첨금, 가상 수익률.
  - **타임라인**: 당첨된 회차와 날짜, 등수를 시간순으로 나열.
  - **차트**: 연도별 당첨 횟수 그래프.

### 2.2. 🚀 나의 번호 당첨확률 높이기 (Probability Booster)

**"백테스팅으로 증명된 최적의 알고리즘으로 내 번호를 업그레이드하자!"**

- **기능 정의**: 백테스팅을 통해 검증된 **'최적 가중치(Optimal Weights)'**를 적용하여 내 번호를 진단하고, 더 높은 확률이 기대되는 번호로 교체를 제안합니다.
- **핵심 로직 (알고리즘 개선)**:
  1. **최적 가중치 로드**: `Data/backtesting_cache/optimal_weights_score.json`에서 백테스팅으로 검증된 최적 파라미터를 가져옵니다. (없을 경우 기본값 사용)
  2. **점수 진단**: 최적화된 모델을 사용하여 사용자 번호 6개의 개별 점수와 조합 점수를 계산합니다.
  3. **약점 분석**: 조합 내에서 점수가 가장 낮은(당첨 확률 기여도가 낮은) 번호를 식별합니다.
  4. **개선 제안**: 해당 번호를 제외하고, 모델이 추천하는 '고득점 번호'를 넣었을 때의 점수 변화를 시뮬레이션합니다.
- **출력 UI**:
  - **현재 점수**: 내 번호의 알고리즘 점수 (0~100점).
  - **진단 리포트**: "회원님의 번호는 '최근 트렌드' 점수가 낮습니다." 등의 분석.
  - **업그레이드 제안**: "7번 대신 12번을 넣으면 점수가 15점 상승합니다!" (Before/After 비교).
  - **교체 버튼**: "🔄 12번으로 교체하기" 버튼을 클릭하면 내 번호가 즉시 업데이트됩니다. (NEW)

### 2.3. 🎨 직관적인 번호 선택 인터페이스 (Lottery Paper UI)

- **디자인**: 실제 로또 용지와 유사한 7x7 그리드 레이아웃.
- **상호작용**: 번호 클릭 시 색상 변경 (선택됨). 다시 클릭 시 해제.
- **제약 조건**: 최대 6개까지만 선택 가능. 6개가 선택되면 분석 버튼 활성화.

## 3. 기술적 구현 계획

### 3.1. 신규 모듈 생성 (`src/my_number_analysis.py`)

- `MyNumberAnalyzer` 클래스 설계.
- `analyze_history(numbers)`: 연대기 분석 메서드.
- `diagnose_and_boost(numbers)`: 확률 높이기 및 개선 제안 메서드.

### 3.2. 기존 모듈 활용

- `src/data_loader.py`: 전체 데이터 로딩.
- `src/prediction_model.py`: 점수 계산 및 최적 가중치 적용.
- `src/recommendation_system.py`: 조합 점수 산출 로직 재사용.

### 3.3. 웹 앱 통합 (`src/web_app.py`)

- 사이드바 메뉴에 **"🎲 나의 번호"** 추가.
- 해당 메뉴 선택 시 `my_number_page()` 함수 호출.
- 두 개의 탭(당첨 연대기, 확률 높이기)으로 구성.
- **번호 선택 UI**: `st.columns`와 `st.button`을 활용하여 7x7 그리드 구현 및 `st.session_state`로 선택 상태 관리.
- **교체 기능**: 진단 탭에서 교체 제안 버튼 클릭 시 `st.session_state.my_numbers` 업데이트 및 페이지 리런 (`st.rerun()`).

## 4. 작업 로드맵

| 단계 | 작업 내용                                                       | 예상 소요 |
| ---- | --------------------------------------------------------------- | --------- |
| 1    | `src/my_number_analysis.py` 모듈 구현                           | 30분      |
| 2    | `src/web_app.py` UI 레이아웃 및 **복권 용지 스타일 입력** 구현  | 45분      |
| 3    | 당첨 연대기 로직 연동 및 시각화                                 | 20분      |
| 4    | 확률 높이기(알고리즘 진단) 로직 연동                            | 30분      |
| 4    | 확률 높이기(알고리즘 진단) 로직 연동 및 **교체 버튼 기능** 구현 | 40분      |
| 5    | 테스트 및 디버깅                                                | 10분      |

## 5. 기대 효과

- 사용자가 수동적으로 추천만 받는 것이 아니라, 자신의 번호를 가지고 능동적으로 참여.
- "백테스팅"과 "알고리즘"이라는 어려운 개념을 "내 번호 점수 매기기"라는 쉬운 형태로 전달.
- 개인화된 분석 경험 제공.- 개인화된 분석 경험 제공.
