# 🚀 실시간 재학습(Real-time Retraining) 고도화 계획

## 1. 개요

현재 '실시간 재학습' 기능은 단순히 저장된 가중치를 불러와 모델을 초기화하는 기능에 국한되어 있습니다. 이를 개선하여 **최신 데이터 자동 반영**, **모델 성능 검증**, **가중치 미세 조정**까지 포함하는 진정한 의미의 실시간 적응형 시스템으로 고도화합니다.

## 2. 현황 및 문제점

- **데이터 단절**: 최신 회차 추첨 후, 사용자가 수동으로 데이터를 업데이트하지 않으면 구버전 데이터로 학습함.
- **검증 부재**: 재학습된 모델이 현재 시점에서 얼마나 유효한지 판단할 지표가 없음.
- **정적 가중치**: 과거에 최적화된 가중치를 그대로 사용하므로, 최신 트렌드 변화를 반영하지 못할 수 있음.

## 3. 개선 목표

1.  **Smart Update**: 재학습 시도 시 최신 데이터를 자동으로 감지하고 업데이트.
2.  **Performance Insight**: 재학습된 모델의 최근 성적표(시뮬레이션 결과) 제시.
3.  **Auto-Tuning**: 최신 데이터를 반영하여 가중치를 자동으로 미세 조정.

## 4. 세부 실행 계획 (Roadmap)

### Phase 1: 스마트 데이터 동기화 (Smart Data Sync)

- **기능**: '재학습' 버튼 클릭 시 동행복권 사이트에서 최신 회차를 확인.
- **로직**:
  1. 현재 데이터의 마지막 회차 확인.
  2. 웹 크롤링으로 최신 회차 확인.
  3. 차이가 있다면 자동 업데이트 수행 및 데이터 리로딩.
- **UI**: "🔄 최신 데이터 확인 중..." -> "✨ 데이터 업데이트 완료!" 메시지 표시.

### Phase 2: 모델 성능 검증 대시보드 (Validation Dashboard)

- **기능**: 재학습 완료 후, 해당 모델의 최근 10회차 예측 성능을 시각화.
- **지표**:
  - 최근 10회차 평균 당첨 개수.
  - 최근 10회차 가상 수익률.
  - 모델의 확신도(Confidence) 추이.

### Phase 3: 가중치 자동 미세 조정 (Auto Fine-tuning)

- **기능**: 기존 최적 가중치를 시작점으로 하여, 최근 데이터에 맞게 가중치를 소폭 조정.
- **로직**:
  - `WeightOptimizer`를 활용하되, 전체 탐색이 아닌 현재 가중치 주변의 좁은 범위만 빠르게 탐색(Local Search).
  - 약 10~20회 시뮬레이션으로 빠르게 최적값 보정.

## 5. 기대 효과

- **편의성**: 데이터 업데이트부터 추천까지 원클릭으로 해결.
- **신뢰도**: 모델의 현재 성능을 눈으로 확인하고 추천받음.
- **적중률**: 최신 트렌드가 반영된 가중치로 적중률 향상 기대.

## 6. 작업 진행 상황

- [x] **Phase 1**: `src/web_app.py`에 스마트 데이터 동기화 기능 구현 및 테스트 완료 (`docs/TEST_REPORT_SMART_SYNC.md`).
- [x] **Phase 2**: `src/prediction_model.py`에 모델 성능 검증 대시보드 구현 완료.
- [x] **Phase 3**: `src/weight_optimizer.py`에 가중치 자동 미세 조정 기능 구현 완료.

## 7. 최종 완료

실시간 재학습 고도화의 모든 단계(Phase 1~3) 구현 및 통합 테스트가 성공적으로 완료되었습니다. (2026-02-07)

실시간 재학습 기능의 고도화(Phase 1~3)가 모두 완료되었습니다. 이제 데이터 동기화 → 가중치 미세 조정 → 모델 재학습 → 성능 검증 → 추천으로 이어지는 전체 파이프라인을 테스트하는 방법을 안내해 드립니다.

🧪 실시간 재학습 전체 파이프라인 테스트 가이드
이 테스트는 사용자가 '재학습' 버튼을 눌렀을 때, 시스템이 스스로 최신 데이터를 가져오고, 스스로 학습 파라미터를 조정한 뒤, 그 결과가 얼마나 믿을만한지 성적표를 보여주는지 확인하는 과정입니다.

1. 준비 단계 (환경 설정)
   프리미엄 기능이므로 개발자 모드로 실행하거나 액세스 코드가 필요합니다.

bash

# 터미널에서 실행

export LOTTO_DEV_MODE=true
streamlit run src/web_app.py 2. 테스트 시나리오 설정 (Phase 1 검증용)
스마트 데이터 동기화가 작동하는지 보려면, 로컬 데이터를 일부러 '구버전'으로 만들어야 합니다.

Data/645_251227.csv 파일을 엽니다.
가장 마지막 행(최신 회차)을 삭제하고 저장합니다.
예: 1210회차가 최신이라면 1210회차 줄을 지워서 1209회차가 마지막이 되게 합니다.
이제 시스템은 "어? 웹에는 1210회가 있는데 나는 없네?"라고 인식해야 합니다. 3. 기능 실행
웹 앱의 사이드바에서 '🔬 백테스팅 결과' 메뉴를 선택합니다.
상단 탭에서 **'🚀 실시간 재학습'**을 클릭합니다.
'🔄 재학습 & 추천 생성' 버튼을 클릭합니다. 4. 단계별 검증 포인트 (UI 확인)
버튼을 누르면 st.status 컨테이너(진행 상황판)가 열리며 다음 단계들이 순차적으로 실행됩니다. 각 단계의 로그를 확인하세요.

단계 화면 메시지 검증 내용

1. 데이터 동기화 (Phase 1) 🌐 최신 데이터 확인 중...✨ [회차]회 최신 데이터 발견! 업데이트 중... 아까 삭제한 회차를 자동으로 감지하고 복구했는지 확인합니다. (이미 최신이라면 "현재 데이터가 최신입니다" 출력)
2. 가중치 조정 (Phase 3) ⚙️ 가중치 미세 조정 중 (Auto Fine-tuning)... 기존 가중치를 바탕으로 미세 조정을 수행하는지 확인합니다. (약간의 시간이 소요됨)
3. 모델 재학습 🤖 모델 재학습 중... 조정된 가중치와 최신 데이터로 모델을 다시 학습합니다.
4. 성능 검증 (Phase 2) 📊 모델 성능 검증 중... 재학습된 모델로 최근 10회차 시뮬레이션을 돌립니다.
5. 추천 생성 🎯 번호 추천 생성 중... 최종 번호를 생성합니다.
6. 최종 결과 확인 (대시보드)
   모든 과정이 끝나면 '✅ 추천 완료!' 메시지와 함께 아래 내용이 표시되어야 합니다.

📊 모델 성능 검증 대시보드:

평균 당첨 개수: 예) 3.2개
가상 수익률 (ROI): 예) -30.5% (빨간색/초록색)
총 당첨금: 가상으로 벌어들인 금액
차트: 회차별 매칭 개수 막대그래프와 모델 확신도 꺾은선 그래프가 겹쳐진 차트.
추천 번호 리스트:

최종적으로 생성된 5개(설정값)의 추천 번호 조합.
✅ 테스트 성공 기준
[ ] CSV 파일에서 삭제했던 회차가 다시 생겨났는가? (Phase 1)
[ ] 진행 상황판에 "가중치 미세 조정" 단계가 표시되었는가? (Phase 3)
[ ] 결과 화면에 "모델 성능 검증" 대시보드와 차트가 떴는가? (Phase 2)
[ ] 최종 추천 번호가 정상적으로 출력되었는가?
이 모든 과정이 버튼 하나로 매끄럽게 이어진다면, 실시간 재학습 고도화 작업이 완벽하게 성공한 것입니다! 🚀
